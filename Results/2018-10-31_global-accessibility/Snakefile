import pandas as pd

CONFIG = pd.read_table("config.tsv", index_col=False)
PEAKS = CONFIG["PeakFile"].tolist()
CONDITIONS = CONFIG["Condition"].unique().tolist()

rule permute_peaks_bp:
    input:
        script = "count-bp-and-peaks.sh",
        peaks = PEAKS
    output:
        "Global/num-peaks-bp.tsv"
    shell:
        "sh {input.script}"

rule test_depth_support:
    input:
        script = "plot-global-acc.R",
        data = "Global/num-peaks-bp.tsv"
    output:
        "Global/peaks-bp.png",
        "Global/global-tests.tsv"
    shell:
        "Rscript {input.script}"

rule generate_consensus:
    input:
        script = "generate-consensus.sh",
        peaks = PEAKS
    output:
        expand("Consensus/{condition}.bed", condition=CONDITIONS),
        expand("Consensus/{condition}.bedGraph", condition=CONDITIONS),
        "Consensus/consensus.bed"
    shell:
        "sh {input.script}"

rule binary_matrix:
    input:
        script = "generate-binary-matrix.R",
        beds = expand("Consensus/{condition}.bed", condition=CONDITIONS),
        consensus = "Consensus/consensus.bed"
    output:
        "Consensus/consensus-matrix.tsv"
    shell:
        "Rscript {input.script}"
